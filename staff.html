<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Management - Urban Walker Vault</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="Urban_Walker_Favicon.ico?v=2">
</head>
<body>
    
    <!--Header-->
    <header>
        <h1>Urban Walker Vault</h1>
        <nav>
            <ul>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="admin.html">Inventory</a></li>
                <li><a href="staff.html">Staff</a></li>
                <li><a href="purchase-history.html">Purchases</a></li>
                <li><a href="index.html">Home</a></li>
                <li><a href="signin.html">Sign Out</a></li>
            </ul>
        </nav>
    </header>

    <!--Staff Management-->
    <main class="staff-page">
        <h2>Add New Staff Member</h2>
        
        <!-- Add Staff Form -->
        <section class="add-staff-section">
            <h2></h2>
            <form id="addStaffForm">
                <label>Full Name</label>
                <input type="text" id="staffName" required>

                <label>Email</label>
                <input type="email" id="staffEmail" required>

                <label>Role</label>
                <select id="staffRole" required>
                    <option value="Staff">Staff</option>
                    <option value="Admin">Admin</option>
                </select>

                <button type="submit" class="btn-primary">Add Staff</button>
            </form>

            <p id="generatedPassword" style="margin-top: 1rem; font-weight: bold;"></p>
        </section>

        <!-- Staff List -->
        <section class="staff-list-section">
            <h3>Current Staff Members</h3>
            <div class="table-container">
                <table id="staffTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Staff members will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!--Footer-->
    <footer>
        <p>Â© 2025 Urban Walker Vault. All rights reserved.</p>
    </footer>   
    
    <script>
const API_BASE = "https://urban-walker-vault-1.onrender.com/api";


/* Random password generator */
function generatePassword(len = 12) {
    const chars =
        "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789!@#$%&*?";
    let pw = "";
    for (let i = 0; i < len; i++) {
        pw += chars[Math.floor(Math.random() * chars.length)];
    }
    return pw;
}

/* Load staff members */
async function loadStaffMembers() {
    const tbody = document.querySelector('#staffTable tbody');
    tbody.innerHTML = `<tr><td colspan="5">Loading...</td></tr>`;

    try {
        const res = await fetch(`${API_BASE}/staff`);
        const staffList = await res.json();

        tbody.innerHTML = "";

        if (!staffList || staffList.length === 0) {
            tbody.innerHTML = `<tr><td colspan="5">No staff found.</td></tr>`;
            return;
        }

        staffList.forEach(s => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${s.id}</td>
                <td>${s.fullName}</td>
                <td>${s.email}</td>
                <td>${s.role}</td>
                <td>
                    <button class="btn-delete-staff" data-id="${s.id}">
                        Delete
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
        });

        document.querySelectorAll('.btn-delete-staff').forEach(btn => {
            btn.addEventListener('click', deleteStaff);
        });

    } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td colspan="5">Failed to load staff.</td></tr>`;
    }
}

/* Delete staff */
async function deleteStaff(event) {
    const id = event.target.dataset.id;

    if (!confirm("Are you sure you want to remove this staff member?")) return;

    try {
        const res = await fetch(`${API_BASE}/staff/${id}`, {
            method: "DELETE",
        });

        const data = await res.json();

        if (!res.ok) {
            alert("Failed to delete staff: " + (data.error || ""));
            return;
        }

        alert("Staff member removed.");
        loadStaffMembers();

    } catch (err) {
        console.error(err);
        alert("Error deleting staff member.");
    }
}

/* Add staff */
document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("addStaffForm");

    form.addEventListener("submit", async e => {
        e.preventDefault();

        const fullName = document.getElementById("staffName").value.trim();
        const email = document.getElementById("staffEmail").value.trim();
        const role = document.getElementById("staffRole").value;

        if (!fullName || !email) {
            alert("Please fill in all required fields.");
            return;
        }

        const password = generatePassword();

        try {
            const res = await fetch(`${API_BASE}/staff`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ fullName, email, role, password })
            });

            const data = await res.json();

            if (!res.ok) {
                alert("Failed to add staff: " + (data.error || ""));
                return;
            }

            alert(
                `Staff member added.\n\n` +
                `Email: ${email}\n` +
                `Password: ${password}\n\n` +
                `Please give these credentials to the staff member.`
            );

            form.reset();
            loadStaffMembers();

        } catch (err) {
            console.error(err);
            alert("Error adding staff.");
        }
    });

    loadStaffMembers();
});
</script>     
</body>
</html>